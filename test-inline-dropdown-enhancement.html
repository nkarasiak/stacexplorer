<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline Dropdown Enhancement Test</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Existing styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/ai-smart-search-enhanced.css">
    <link rel="stylesheet" href="css/enhanced-search-summary.css">
    
    <!-- New inline dropdown styles -->
    <link rel="stylesheet" href="css/inline-dropdown.css">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--md-bg-default);
            color: var(--md-text-primary);
        }
        
        .test-container {
            display: flex;
            height: 100vh;
        }
        
        .test-sidebar {
            width: 360px;
            background: var(--md-surface);
            padding: 20px;
        }
        
        .test-main {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .test-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 20px;
            color: var(--md-primary);
        }
        
        .test-description {
            background: var(--md-surface);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 600px;
        }
        
        .test-description h3 {
            color: var(--md-primary);
            margin-top: 0;
        }
        
        .test-search-summary {
            background: linear-gradient(135deg, #6a4de0 0%, #4a8cda 100%);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            color: white;
        }
        
        .test-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-summary-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }
        
        .test-summary-label {
            font-weight: 500;
            font-size: 14px;
        }
        
        .test-summary-value {
            font-weight: 600;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .test-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .test-btn {
            background: var(--md-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-btn:hover {
            background: var(--md-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .test-feature {
            background: var(--md-surface);
            padding: 16px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid var(--md-primary);
        }
        
        .test-feature h4 {
            margin: 0 0 8px 0;
            color: var(--md-primary);
        }
        
        .test-feature p {
            margin: 0;
            color: var(--md-text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="test-container">
        <!-- Test Sidebar -->
        <div class="test-sidebar" id="sidebar">
            <h2 style="margin-top: 0; color: var(--md-primary);">
                <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">tune</i>
                Search Options
            </h2>
            
            <div class="test-search-summary">
                <div class="test-summary-item search-summary-item" data-field="collection">
                    <span class="test-summary-label">
                        <i class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 6px;">dataset</i>
                        Data Source
                    </span>
                    <span class="test-summary-value search-summary-value">EVERYTHING</span>
                </div>
                
                <div class="test-summary-item search-summary-item" data-field="location">
                    <span class="test-summary-label">
                        <i class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 6px;">place</i>
                        Location
                    </span>
                    <span class="test-summary-value search-summary-value">THE WORLD</span>
                </div>
                
                <div class="test-summary-item search-summary-item" data-field="date">
                    <span class="test-summary-label">
                        <i class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 6px;">event</i>
                        Time Period
                    </span>
                    <span class="test-summary-value search-summary-value">ANYTIME</span>
                </div>
            </div>
            
            <div class="test-feature">
                <h4>âœ¨ Enhanced Menu Behavior</h4>
                <p>Click any search option above to see the inline dropdown - no more fullscreen overload!</p>
            </div>
            
            <div class="test-feature">
                <h4>ðŸŽ¯ Smart Positioning</h4>
                <p>Dropdowns appear exactly where you expect them, with smart collision detection.</p>
            </div>
            
            <div class="test-feature">
                <h4>âš¡ Streamlined UX</h4>
                <p>Perfect for quick selections without losing context of your search.</p>
            </div>
        </div>
        
        <!-- Test Main Area -->
        <div class="test-main">
            <h1 class="test-title">ðŸš€ Inline Dropdown Enhancement</h1>
            
            <div class="test-description">
                <h3>ðŸŽ¯ What's New</h3>
                <p>The left menu now shows <strong>inline dropdowns</strong> instead of opening the fullscreen AI search interface. This provides a much more streamlined experience for quick option selection.</p>
                
                <h3>ðŸ“‹ How to Test</h3>
                <ol>
                    <li>Click on any search option in the left sidebar (Data Source, Location, Time Period)</li>
                    <li>Notice how a beautiful dropdown appears inline</li>
                    <li>Select an option and see the summary update</li>
                    <li>No more fullscreen "overkill" - just clean, focused interactions!</li>
                </ol>
                
                <h3>âœ¨ Features</h3>
                <ul>
                    <li><strong>Collections:</strong> Browse all available datasets with search and source grouping</li>
                    <li><strong>Locations:</strong> Search places, draw on map, or paste WKT/GeoJSON</li>
                    <li><strong>Dates:</strong> Quick presets or custom date ranges</li>
                    <li><strong>Responsive:</strong> Works great on desktop and mobile</li>
                    <li><strong>Accessible:</strong> Keyboard navigation and screen reader support</li>
                </ul>
            </div>
            
            <div class="test-buttons">
                <button class="test-btn" onclick="testInlineDropdowns()">
                    <i class="material-icons">play_arrow</i>
                    Initialize Test
                </button>
                
                <button class="test-btn" onclick="resetTest()">
                    <i class="material-icons">refresh</i>
                    Reset
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Mock dependencies for testing
        class MockAPIClient {
            setEndpoints(endpoints) {
                console.log('Mock API endpoints set:', endpoints);
            }
            
            async fetchCollections() {
                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                return [
                    { 
                        id: 'sentinel-2-l2a', 
                        title: 'Sentinel-2 Level-2A', 
                        source: 'copernicus',
                        displayTitle: 'Sentinel-2 Level-2A'
                    },
                    { 
                        id: 'landsat-c2-l2', 
                        title: 'Landsat Collection 2 Level-2', 
                        source: 'element84',
                        displayTitle: 'Landsat Collection 2 Level-2'
                    },
                    { 
                        id: 'sentinel-1-grd', 
                        title: 'Sentinel-1 GRD', 
                        source: 'copernicus',
                        displayTitle: 'Sentinel-1 GRD'
                    },
                    { 
                        id: 'modis-mod09ga-006', 
                        title: 'MODIS Terra Surface Reflectance', 
                        source: 'element84',
                        displayTitle: 'MODIS Terra Surface Reflectance'
                    }
                ];
            }
        }
        
        class MockNotificationService {
            showNotification(message, type) {
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // Show visual notification
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="material-icons">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : 'info'}</i>
                    ${message}
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        }
        
        class MockSearchPanel {
            performSearch(params) {
                console.log('Mock search executed with params:', params);
                return Promise.resolve([]);
            }
        }
        
        class MockCollectionManager {
            constructor() {
                this.collections = [];
            }
            
            getCollectionById(id) {
                return this.collections.find(c => c.id === id) || { id, title: `Mock ${id}` };
            }
            
            getAllCollections() {
                return this.collections;
            }
        }
        
        class MockMapManager {
            startDrawingBbox(callback) {
                console.log('Mock drawing started');
                setTimeout(() => {
                    callback([10.0, 45.0, 15.0, 50.0]); // Mock bbox
                }, 1000);
            }
            
            getCurrentBounds() {
                return [10.0, 45.0, 15.0, 50.0];
            }
        }
        
        // Mock global config
        window.stacExplorer = {
            config: {
                stacEndpoints: {
                    copernicus: {
                        collections: 'https://catalogue.dataspace.copernicus.eu/stac/collections',
                        search: 'https://catalogue.dataspace.copernicus.eu/stac/search'
                    },
                    element84: {
                        collections: 'https://earth-search.aws.element84.com/v1/collections',
                        search: 'https://earth-search.aws.element84.com/v1/search'
                    }
                }
            }
        };
        
        // Import and initialize
        import { InlineDropdownManager } from './js/components/ui/InlineDropdownManager.js';
        
        let inlineDropdownManager;
        
        // Global test functions
        window.testInlineDropdowns = async function() {
            console.log('ðŸ§ª Initializing inline dropdown test...');
            
            // Initialize mock dependencies
            const mockApiClient = new MockAPIClient();
            const mockNotificationService = new MockNotificationService();
            const mockSearchPanel = new MockSearchPanel();
            const mockCollectionManager = new MockCollectionManager();
            const mockMapManager = new MockMapManager();
            
            // Initialize inline dropdown manager
            inlineDropdownManager = new InlineDropdownManager(
                mockApiClient,
                mockSearchPanel,
                mockCollectionManager,
                mockMapManager,
                mockNotificationService
            );
            
            mockNotificationService.showNotification('âœ¨ Inline dropdowns initialized! Click any search option in the left menu.', 'success');
            
            console.log('âœ… Test initialization complete');
        };
        
        window.resetTest = function() {
            console.log('ðŸ”„ Resetting test...');
            
            // Close any open dropdowns
            if (inlineDropdownManager) {
                inlineDropdownManager.closeCurrentDropdown();
            }
            
            // Reset summary values
            document.querySelectorAll('.search-summary-value').forEach(el => {
                const field = el.closest('.search-summary-item').dataset.field;
                switch(field) {
                    case 'collection':
                        el.textContent = 'EVERYTHING';
                        break;
                    case 'location':
                        el.textContent = 'THE WORLD';
                        break;
                    case 'date':
                        el.textContent = 'ANYTIME';
                        break;
                }
            });
            
            // Remove active states
            document.querySelectorAll('.dropdown-active').forEach(el => {
                el.classList.remove('dropdown-active');
            });
            
            new MockNotificationService().showNotification('ðŸ”„ Test reset complete', 'info');
        };
        
        // Auto-initialize after a short delay
        setTimeout(() => {
            console.log('ðŸš€ Auto-initializing test...');
            window.testInlineDropdowns();
        }, 1000);
        
        console.log('âœ… Inline dropdown test page loaded successfully');
    </script>
</body>
</html>
