<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>URL State Management Fix Test - STAC Explorer</title>\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"css/styles.css\">\n    <style>\n        .test-container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n            background: var(--md-bg-default);\n            color: var(--md-text-primary);\n        }\n        \n        .test-section {\n            margin-bottom: 40px;\n            padding: 20px;\n            background: var(--md-surface);\n            border-radius: 8px;\n            box-shadow: var(--elevation-2);\n        }\n        \n        .test-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 16px;\n            color: var(--md-primary);\n        }\n        \n        .test-description {\n            font-size: 16px;\n            line-height: 1.6;\n            margin-bottom: 20px;\n            color: var(--md-text-secondary);\n        }\n        \n        .fix-note {\n            background: linear-gradient(45deg, var(--md-success), #4CAF50);\n            color: white;\n            padding: 16px;\n            border-radius: 8px;\n            margin-bottom: 20px;\n            font-weight: 500;\n        }\n        \n        .example-url {\n            background: var(--md-surface-overlay);\n            padding: 12px;\n            border-radius: 4px;\n            font-family: 'Courier New', monospace;\n            font-size: 14px;\n            word-break: break-all;\n            margin: 8px 0;\n            border-left: 4px solid var(--md-primary);\n        }\n        \n        .feature-list {\n            list-style: none;\n            padding: 0;\n        }\n        \n        .feature-list li {\n            padding: 8px 0;\n            border-bottom: 1px solid var(--md-border-color);\n            display: flex;\n            align-items: center;\n        }\n        \n        .feature-list li:last-child {\n            border-bottom: none;\n        }\n        \n        .feature-list li i {\n            color: var(--md-success);\n            margin-right: 12px;\n            font-size: 20px;\n        }\n        \n        .before-after {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin-top: 20px;\n        }\n        \n        .before, .after {\n            padding: 16px;\n            border-radius: 8px;\n        }\n        \n        .before {\n            background: rgba(244, 67, 54, 0.1);\n            border-left: 4px solid var(--md-danger);\n        }\n        \n        .after {\n            background: rgba(76, 175, 80, 0.1);\n            border-left: 4px solid var(--md-success);\n        }\n        \n        .test-button {\n            background: linear-gradient(45deg, var(--md-primary), #3F51B5);\n            color: white;\n            border: none;\n            border-radius: 6px;\n            padding: 12px 24px;\n            font-weight: 500;\n            font-size: 16px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin: 8px;\n        }\n        \n        .test-button:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);\n        }\n        \n        .code-block {\n            background: var(--md-bg-default);\n            border: 1px solid var(--md-border-color);\n            border-radius: 4px;\n            padding: 16px;\n            margin: 16px 0;\n            font-family: 'Courier New', monospace;\n            font-size: 14px;\n            overflow-x: auto;\n        }\n        \n        @media (max-width: 768px) {\n            .before-after {\n                grid-template-columns: 1fr;\n            }\n        }\n    </style>\n</head>\n<body class=\"dark-theme\">\n    <div class=\"test-container\">\n        <h1 style=\"text-align: center; color: var(--md-primary); font-size: 32px; margin-bottom: 40px;\">\n            üîó URL State Management Fix Test\n        </h1>\n        \n        <div class=\"fix-note\">\n            <i class=\"material-icons\" style=\"margin-right: 8px;\">check_circle</i>\n            URL state restoration has been fixed! Copy/paste URLs now properly restore your view instead of falling back to AI Smart Search.\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üõ†Ô∏è Issues Fixed</h2>\n            <ul class=\"feature-list\">\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Fixed MapLibre GL API calls (was using Leaflet-style methods)</span>\n                </li>\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Corrected coordinate format handling (lat,lng vs lng,lat)</span>\n                </li>\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Proper component initialization order</span>\n                </li>\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Prevent AI Smart Search from overriding URL restoration</span>\n                </li>\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Enhanced error handling and logging</span>\n                </li>\n                <li>\n                    <i class=\"material-icons\">check_circle</i>\n                    <span>Improved UI restoration (card expansion, item highlighting)</span>\n                </li>\n            </ul>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üß™ How to Test</h2>\n            <div class=\"test-description\">\n                Follow these steps to verify the URL state restoration is working:\n            </div>\n            \n            <ol style=\"padding-left: 20px; line-height: 1.8;\">\n                <li><strong>Search for items:</strong> Use the main application to search for STAC items</li>\n                <li><strong>Select an item:</strong> Click on a dataset item to view it on the map</li>\n                <li><strong>Copy the URL:</strong> The URL will be automatically updated with state parameters</li>\n                <li><strong>Open in new tab:</strong> Copy the URL and paste it in a new browser tab</li>\n                <li><strong>Verify restoration:</strong> The application should restore your exact view instead of showing AI Smart Search</li>\n            </ol>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üìã Example URLs</h2>\n            <div class=\"test-description\">\n                Here are examples of URLs with state parameters that should now work correctly:\n            </div>\n            \n            <h4>URL with Active Item and Geometry:</h4>\n            <div class=\"example-url\">\n                http://localhost:8000/?mapCenter=60.693355,8.358168&mapZoom=2.88&activeItem=S5P_NRTI_L2__NO2____20250601T122909_20250601T123409_39556_03_020800_20250601T130902&activeAsset=geometry\n            </div>\n            \n            <h4>URL with Search Parameters:</h4>\n            <div class=\"example-url\">\n                http://localhost:8000/?collection=sentinel-2-l2a&search=france&dateStart=2024-01-01&dateEnd=2024-12-31&mapCenter=46.603354,1.888334&mapZoom=6.5\n            </div>\n            \n            <h4>URL with Bounding Box:</h4>\n            <div class=\"example-url\">\n                http://localhost:8000/?bbox=2.0,46.0,3.0,47.0&mapCenter=46.5,2.5&mapZoom=8.2&collection=landsat-c2-l2\n            </div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üîß Technical Changes</h2>\n            \n            <h3 style=\"color: var(--md-primary); margin: 20px 0 10px 0;\">StateManager.js Enhancements:</h3>\n            <div class=\"code-block\">\n// Fixed MapLibre GL API calls\n// Before (incorrect):\nthis.mapManager.map.setView([lat, lng], zoom);\n\n// After (correct):\nthis.mapManager.map.setCenter([lng, lat]);\nthis.mapManager.map.setZoom(zoom);\n            </div>\n            \n            <h3 style=\"color: var(--md-primary); margin: 20px 0 10px 0;\">App.js Logic Update:</h3>\n            <div class=\"code-block\">\n// Only show AI Smart Search if no URL state parameters\nif (!stateManager.hasUrlStateParams()) {\n    console.log('ü§ñ No URL state detected, showing AI Smart Search');\n    aiSmartSearch.showMinimalistSearch();\n} else {\n    console.log('üîó URL state parameters detected, skipping AI Smart Search');\n}\n            </div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üìä Before vs After</h2>\n            \n            <div class=\"before-after\">\n                <div class=\"before\">\n                    <h4>‚ùå Before Fix</h4>\n                    <ul style=\"padding-left: 20px; margin: 12px 0;\">\n                        <li>Copy/paste URL ‚Üí Shows AI Smart Search</li>\n                        <li>Map state not restored correctly</li>\n                        <li>Active items not displayed</li>\n                        <li>Search parameters ignored</li>\n                        <li>Console errors with map API</li>\n                    </ul>\n                </div>\n                \n                <div class=\"after\">\n                    <h4>‚úÖ After Fix</h4>\n                    <ul style=\"padding-left: 20px; margin: 12px 0;\">\n                        <li>Copy/paste URL ‚Üí Restores exact view</li>\n                        <li>Map positioned correctly</li>\n                        <li>Active items displayed on map</li>\n                        <li>Search parameters applied</li>\n                        <li>Clean initialization with logging</li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üéØ Test Scenarios</h2>\n            \n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 20px;\">\n                <button class=\"test-button\" onclick=\"testScenario1()\">\n                    üìç Test Active Item URL\n                </button>\n                <button class=\"test-button\" onclick=\"testScenario2()\">\n                    üîç Test Search State URL\n                </button>\n                <button class=\"test-button\" onclick=\"testScenario3()\">\n                    üó∫Ô∏è Test Map Position URL\n                </button>\n                <button class=\"test-button\" onclick=\"testScenario4()\">\n                    üì¶ Test Bounding Box URL\n                </button>\n            </div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h2 class=\"test-title\">üöÄ Performance Impact</h2>\n            <div class=\"test-description\">\n                The fix includes several performance optimizations:\n                <ul style=\"padding-left: 20px; margin-top: 12px;\">\n                    <li><strong>Efficient State Detection:</strong> Quick check for URL parameters before heavy initialization</li>\n                    <li><strong>Proper Component Waiting:</strong> Avoids redundant API calls during restoration</li>\n                    <li><strong>Smart Event Listening:</strong> Prevents duplicate event handlers during URL restoration</li>\n                    <li><strong>Optimized Map Operations:</strong> Uses native MapLibre GL methods for better performance</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        function testScenario1() {\n            const testUrl = window.location.origin + '/?mapCenter=60.693355,8.358168&mapZoom=2.88&activeItem=S5P_NRTI_L2__NO2____20250601T122909_20250601T123409_39556_03_020800_20250601T130902&activeAsset=geometry';\n            alert('üß™ Test Scenario 1: Active Item URL\\n\\n' +\n                  'This will open a URL with an active item and geometry asset.\\n' +\n                  'Expected: Map should show the item with beautiful gradient geometry.\\n\\n' +\n                  'URL: ' + testUrl);\n            window.open(testUrl, '_blank');\n        }\n        \n        function testScenario2() {\n            const testUrl = window.location.origin + '/?collection=sentinel-2-l2a&search=france&dateStart=2024-01-01&dateEnd=2024-12-31&mapCenter=46.603354,1.888334&mapZoom=6.5';\n            alert('üß™ Test Scenario 2: Search State URL\\n\\n' +\n                  'This will open a URL with search parameters pre-filled.\\n' +\n                  'Expected: Search form should be populated and results displayed.\\n\\n' +\n                  'URL: ' + testUrl);\n            window.open(testUrl, '_blank');\n        }\n        \n        function testScenario3() {\n            const testUrl = window.location.origin + '/?mapCenter=40.7128,-74.0060&mapZoom=10.5';\n            alert('üß™ Test Scenario 3: Map Position URL\\n\\n' +\n                  'This will open a URL with specific map center and zoom.\\n' +\n                  'Expected: Map should be positioned over New York City.\\n\\n' +\n                  'URL: ' + testUrl);\n            window.open(testUrl, '_blank');\n        }\n        \n        function testScenario4() {\n            const testUrl = window.location.origin + '/?bbox=2.0,46.0,3.0,47.0&mapCenter=46.5,2.5&mapZoom=8.2&collection=landsat-c2-l2';\n            alert('üß™ Test Scenario 4: Bounding Box URL\\n\\n' +\n                  'This will open a URL with a bounding box and collection.\\n' +\n                  'Expected: Bounding box should be set and collection selected.\\n\\n' +\n                  'URL: ' + testUrl);\n            window.open(testUrl, '_blank');\n        }\n        \n        // Add some visual feedback for the test buttons\n        document.querySelectorAll('.test-button').forEach(button => {\n            button.addEventListener('mouseenter', function() {\n                this.style.transform = 'translateY(-2px) scale(1.02)';\n            });\n            \n            button.addEventListener('mouseleave', function() {\n                this.style.transform = 'translateY(0) scale(1)';\n            });\n        });\n    </script>\n</body>\n</html>\n